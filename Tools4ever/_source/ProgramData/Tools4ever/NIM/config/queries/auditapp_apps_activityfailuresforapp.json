{"name":"AuditApp_Apps_ActivityFailuresForApp","query":"-- Swiss-army knife for all app failures\nSELECT\n  STRFTIME('%F %T', COALESCE(apaac.StartDateTime, apa.StartDateTime, aps.StartDateTime) , 'localtime') 'DateTime',\n  aps.ID 'AppSessionID',\n  usr.Name 'UserName',\n  ses.IpAddress,\n  ses.UserAgent,\n  app.Name 'AppName',\n  apa.ID 'AppActivityID',\n  afu.FormName,\n  afu.UnitID,\n  afu.UnitDescription,\n  apaa.ActionFsRef,\n  apaa.ActionSeqNr,\n  apat.Name 'ActionType',\n  apac.Name 'ActionName',\n  apaac.CallSeqNr,\n  apaac.CallDescription,\n  COALESCE(apaac_apec.Error, apa_apec.Error, aps_apec.Error) 'Error',\n  COALESCE(apaac_apr.Message, apa_apr.Message, aps_apr.Message) 'Message'\nFROM\n  AppSessions AS aps\n  INNER JOIN Sessions AS ses ON aps.SessionID = ses.ID\n  INNER JOIN Users AS usr ON ses.UserID = usr.ID\n  INNER JOIN Apps AS app ON aps.AppID = app.ID\n  LEFT JOIN AppActivity AS apa ON aps.ID = apa.AppSessionID\n  LEFT JOIN AppFormUnits AS afu ON apa.AppFormUnitID = afu.ID\n  LEFT JOIN AppActivityActions AS apaa ON apa.ID = apaa.AppActivityID\n  LEFT JOIN AppActions AS apac ON apaa.AppActionID = apac.ID\n  LEFT JOIN AppActionTypes AS apat ON apac.AppActionTypeID = apat.ID\n  LEFT JOIN AppActivityActionCalls AS apaac ON apaa.ID = apaac.AppActivityActionID\n  LEFT JOIN AppResults AS apaac_apr ON apaac.AppResultID = apaac_apr.ID\n  LEFT JOIN AppErrorCodes AS apaac_apec ON apaac_apr.AppErrorCodeID = apaac_apec.ID\n  LEFT JOIN AppResults AS apa_apr ON (apa.AppResultID = apa_apr.ID AND apaac.AppActivityActionID IS NULL)\n  LEFT JOIN AppErrorCodes AS apa_apec ON apa_apr.AppErrorCodeID = apa_apec.ID\n  LEFT JOIN AppResults AS aps_apr ON (aps.AppResultID = aps_apr.ID AND apa.AppSessionID IS NULL)\n  LEFT JOIN AppErrorCodes AS aps_apec ON aps_apr.AppErrorCodeID = aps_apec.ID\nWHERE\n  aps.`AppID` = $AppID\n  AND COALESCE(apaac_apec.Error, apa_apec.Error, aps_apec.Error) <> 'success'","params":[{"name":"AppID","description":"","category":"input","type":"string","default_value":""}],"columns":[{"name":"DateTime","type":0},{"name":"AppSessionID","type":1},{"name":"UserName","type":0},{"name":"IpAddress","type":0},{"name":"UserAgent","type":0},{"name":"AppName","type":0},{"name":"AppActivityID","type":1},{"name":"FormName","type":0},{"name":"UnitID","type":0},{"name":"UnitDescription","type":0},{"name":"ActionFsRef","type":0},{"name":"ActionSeqNr","type":1},{"name":"ActionType","type":0},{"name":"ActionName","type":0},{"name":"CallSeqNr","type":1},{"name":"CallDescription","type":0},{"name":"Error","type":0},{"name":"Message","type":0}]}