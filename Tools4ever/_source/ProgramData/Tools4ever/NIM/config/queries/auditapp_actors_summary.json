{"name":"AuditApp_Actors_Summary","query":"WITH AttributeUpdateCounts AS (\n    SELECT \n        AC.UserID,\n        COUNT(*) AS AttributeUpdateCount\n    FROM AttributeUpdates AU\n    INNER JOIN ObjectMutations OM ON OM.ID = AU.ObjectMutationID\n    INNER JOIN Activities AC ON AC.ID = OM.ActivityID\n    GROUP BY AC.UserID\n),\nMembershipUpdateCounts AS (\n    SELECT \n        AC.UserID,\n        COUNT(*) AS MembershipUpdateCount\n    FROM Memberships M\n    INNER JOIN Activities AC ON AC.ID = M.ActivityID\n    GROUP BY AC.UserID\n),\nSessionCounts AS (\n  SELECT \n    UserID,\n    COUNT(*) AS SessionCount\n    FROM `Sessions`\n    GROUP BY UserID\n),\nAppUsageCounts AS (\n    SELECT  \n      usr.ID AS 'UserID',\n      COUNT(DISTINCT aps.ID) AS 'AppCount'\n  FROM AppSessions AS aps\n  INNER JOIN Sessions AS ses ON aps.SessionID = ses.ID\n  INNER JOIN Users AS usr ON ses.UserID = usr.ID\n  INNER JOIN Apps ON aps.AppID = apps.ID\n  GROUP BY usr.ID\n)\nSELECT \n    U.ID AS 'ID',\n    U.Name AS 'Actor',\n    COALESCE(AUC.AttributeUpdateCount, 0) AS 'Attribute Activity',\n    COALESCE(MUC.MembershipUpdateCount, 0) AS 'Membership Activity',\n    COALESCE(SUC.SessionCount, 0) AS 'Session Activity',\n    COALESCE(AUUC.AppCount, 0) AS 'Apps Activity'\nFROM Users U\nLEFT JOIN AttributeUpdateCounts AUC ON AUC.UserID = U.ID\nLEFT JOIN MembershipUpdateCounts MUC ON MUC.UserID = U.ID\nLEFT JOIN SessionCounts SUC ON SUC.UserID = U.ID\nLEFT JOIN AppUsageCounts AUUC ON AUUC.UserID = U.ID\nORDER BY U.Name ASC","params":[],"columns":[{"name":"ID","type":1},{"name":"Actor","type":0},{"name":"Attribute Activity","type":0},{"name":"Membership Activity","type":0},{"name":"Session Activity","type":0},{"name":"Apps Activity","type":0}]}